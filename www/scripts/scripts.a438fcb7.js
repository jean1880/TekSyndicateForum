"use strict";angular.module("tekForumApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","LocalStorageModule","infinite-scroll"]).config(["$routeProvider","localStorageServiceProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/:id",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/topic/:id",{templateUrl:"views/topic.html",controller:"TopicCtrl"}).otherwise({redirectTo:"/"}),b.setPrefix("TekForum")}]),angular.module("tekForumApp").controller("MainCtrl",["$scope","FactoryCategory","FactoryTopic","$cookies","localStorageService","$routeParams",function(a,b,c,d,e,f){a.GetCategories=function(){b.get().success(function(b){console.log(b),a.categoryList=b.category_list.categories,e.set("categoryList",JSON.stringify(b.category_list.categories))})},a.GetTopics=function(){f.id?c.getLatestCategory(f.id).success(function(b){a.UpdateTopics(b,null,!0)}):c.getLatest().success(function(b){a.UpdateTopics(b,e,!0)})},a.UpdateTopics=function(b,c,d){console.log(b),console.log(a.page),d?(a.page=1,a.topicList=b.topic_list.topics):a.topicList.push.apply(a.topicList,b.topic_list.topics),c&&c.set("topicList",JSON.stringify(b.topic_list.topics))},a.FetchTopics=function(){a.page++,f.id?c.getLatestCategory(f.id,a.page).success(function(b){a.UpdateTopics(b)}):c.getLatest(a.page).success(function(b){a.UpdateTopics(b)})},a.init=function(){d["XSRF-TOKEN"]="M8JjiA4/pV6L2pR94qd4BQMoaCmLXsmgLks7xdNd+HA=",f.id||(a.categoryList=e.get("categoryList"),a.topicList=e.get("topicList")||[]),a.page=1,a.GetCategories(),a.GetTopics()},a.init()}]),angular.module("tekForumApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("tekForumApp").factory("FactoryCategory",["$http","ServerAddress",function(a,b){return{get:function(){return a.get(b+"categories.json")}}}]),angular.module("tekForumApp").factory("FactoryTopic",["$http","ServerAddress",function(a,b){var c=function(a){return"?no_definitions=true&page="+a+"&slow_platform=true"};return{get:function(c){return a.get(b+"t/"+c+".json")},getLatest:function(d){var e="";return d&&(e=c(d)),a.get(b+"latest.json"+e)},getLatestCategory:function(d,e){var f="";return e&&(f=c(e)),a.get(b+"/c/"+d+"/l/latest.json"+f)},getPosts:function(c,d){return a.get(b+"t/"+c+"/posts.json?"+d)}}}]),angular.module("tekForumApp").factory("FactoryPost",["$http","ServerAddress",function(a,b){return{get:function(c){return a.get(b+"posts.json?"+c)}}}]),angular.module("tekForumApp").factory("FactoryUser",function(){var a=42;return{someMethod:function(){return a}}}),angular.module("tekForumApp").factory("FactoryBadge",function(){var a=42;return{someMethod:function(){return a}}}),angular.module("tekForumApp").factory("FactoryNotification",function(){var a=42;return{someMethod:function(){return a}}}),angular.module("tekForumApp").factory("FactoryPrivateMessage",function(){var a=42;return{someMethod:function(){return a}}}),angular.module("tekForumApp").constant("ServerAddress","https://forum.teksyndicate.com/"),angular.module("tekForumApp").controller("TopicCtrl",["$scope","$routeParams","FactoryTopic","$timeout",function(a,b,c,d){a.init=function(){c.get(b.id).success(function(b){a.topic=b,a.postCount=b.post_stream.posts.length,a.MAXPOSTCOUNT=b.posts_count,a.FormatImages(),console.log(a.topic)})},a.FormatImages=function(){d(function(){$("#topic-board").find("img, iframe").each(function(){$(this).addClass("img img-responsive"),$(this).attr("src").match("^http")||($(this).attr("src").match("^/user_avatar")||$(this).attr("src").match("^/images")?$(this).attr("src","https://forum.teksyndicate.com"+$(this).attr("src")):$(this).attr("src","http://"+$(this).attr("src")))}),$(".lazyYT").lazyYT(),$(".lazyYT").addClass("img img-responsive")},450)},a.FetchPosts=function(){if(a.postCount<a.MAXPOSTCOUNT){for(var b="",d="",e=0;20>e&&a.topic.post_stream.stream[e+a.postCount];e++)1==e&&(d="&"),b=b+d+"post_ids%5B%5D="+a.topic.post_stream.stream[e+a.postCount];a.postCount+=20,c.getPosts(a.topic.id,b).success(function(b){a.topic.post_stream.posts.push.apply(a.topic.post_stream.posts,b.post_stream.posts),a.FormatImages()})}},a.init()}]),angular.module("tekForumApp").filter("Sanitize",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),$(document).on("click","a:not(.local)",function(a){a.preventDefault(),window.open($(a.target).attr("href"),"_system")}),angular.module("tekForumApp").filter("ExtractFile",function(){return function(a){return a.replace(/^.*[\\\/]/,"")}}),angular.module("tekForumApp").filter("moment",function(){return function(a){return console.log(a),console.log(moment(a).fromNow()),moment(a).fromNow()}}),function(a){function b(b,c){var d,e,f,g=b.data("width"),h=b.data("height"),i=b.data("ratio")?b.data("ratio"):c.default_ratio,j=b.data("youtube-id"),k=[],l=b.text()?b.text():c.loading_text,m=b.data("parameters")||"";i=i.split(":"),"number"==typeof g&&"number"==typeof h?(b.width(g),d=h+"px"):"number"==typeof g?(b.width(g),d=g*i[1]/i[0]+"px"):(g=b.width(),0==g&&(g=b.parent().width()),d=i[1]/i[0]*100+"%"),k.push('<div class="ytp-thumbnail">'),k.push('<div class="ytp-large-play-button"'),640>=g&&k.push(' style="transform: scale(0.563888888888889);"'),k.push(">"),k.push("<svg>"),k.push('<path fill-rule="evenodd" clip-rule="evenodd" fill="#1F1F1F" class="ytp-large-play-button-svg" d="M84.15,26.4v6.35c0,2.833-0.15,5.967-0.45,9.4c-0.133,1.7-0.267,3.117-0.4,4.25l-0.15,0.95c-0.167,0.767-0.367,1.517-0.6,2.25c-0.667,2.367-1.533,4.083-2.6,5.15c-1.367,1.4-2.967,2.383-4.8,2.95c-0.633,0.2-1.316,0.333-2.05,0.4c-0.767,0.1-1.3,0.167-1.6,0.2c-4.9,0.367-11.283,0.617-19.15,0.75c-2.434,0.034-4.883,0.067-7.35,0.1h-2.95C38.417,59.117,34.5,59.067,30.3,59c-8.433-0.167-14.05-0.383-16.85-0.65c-0.067-0.033-0.667-0.117-1.8-0.25c-0.9-0.133-1.683-0.283-2.35-0.45c-2.066-0.533-3.783-1.5-5.15-2.9c-1.033-1.067-1.9-2.783-2.6-5.15C1.317,48.867,1.133,48.117,1,47.35L0.8,46.4c-0.133-1.133-0.267-2.55-0.4-4.25C0.133,38.717,0,35.583,0,32.75V26.4c0-2.833,0.133-5.95,0.4-9.35l0.4-4.25c0.167-0.966,0.417-2.05,0.75-3.25c0.7-2.333,1.567-4.033,2.6-5.1c1.367-1.434,2.967-2.434,4.8-3c0.633-0.167,1.333-0.3,2.1-0.4c0.4-0.066,0.917-0.133,1.55-0.2c4.9-0.333,11.283-0.567,19.15-0.7C35.65,0.05,39.083,0,42.05,0L45,0.05c2.467,0,4.933,0.034,7.4,0.1c7.833,0.133,14.2,0.367,19.1,0.7c0.3,0.033,0.833,0.1,1.6,0.2c0.733,0.1,1.417,0.233,2.05,0.4c1.833,0.566,3.434,1.566,4.8,3c1.066,1.066,1.933,2.767,2.6,5.1c0.367,1.2,0.617,2.284,0.75,3.25l0.4,4.25C84,20.45,84.15,23.567,84.15,26.4z M33.3,41.4L56,29.6L33.3,17.75V41.4z"></path>'),k.push('<polygon fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" points="33.3,41.4 33.3,17.75 56,29.6"></polygon>'),k.push("</svg>"),k.push("</div>"),k.push("</div>"),k.push('<div class="html5-info-bar">'),k.push('<div class="html5-title">'),k.push('<div class="html5-title-text-wrapper">'),k.push('<a id="lazyYT-title-',j,'" class="html5-title-text" target="_blank" tabindex="3100" href="https://www.youtube.com/watch?v=',j,'">'),k.push(l),k.push("</a>"),k.push("</div>"),k.push("</div>"),k.push("</div>"),b.css({"padding-bottom":d}).html(k.join("")),f=g>640?"maxresdefault.jpg":g>480?"sddefault.jpg":g>320?"hqdefault.jpg":g>120?"mqdefault.jpg":0==g?"hqdefault.jpg":"default.jpg",e=b.find(".ytp-thumbnail").css({"background-image":["url(http://img.youtube.com/vi/",j,"/",f,")"].join("")}).addClass("lazyYT-image-loaded").on("click",function(a){a.preventDefault(),!b.hasClass("lazyYT-video-loaded")&&e.hasClass("lazyYT-image-loaded")&&b.html('<iframe src="https://www.youtube.com/embed/'+j+"?autoplay=1&"+m+'" frameborder="0" allowfullscreen></iframe>').addClass("lazyYT-video-loaded")}),a.getJSON("https://gdata.youtube.com/feeds/api/videos/"+j+"?v=2&alt=json",function(a){b.find("#lazyYT-title-"+j).text(a.entry.title.$t)})}a.fn.lazyYT=function(c){var d={loading_text:"Loading...",default_ratio:"16:9",callback:null,container_class:"lazyYT-container"},e=a.extend(d,c);return this.each(function(){var c=a(this).addClass(e.container_class);b(c,e)})}}(jQuery);